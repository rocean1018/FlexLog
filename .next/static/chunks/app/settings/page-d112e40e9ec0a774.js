(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[662],{1166:(e,t,r)=>{"use strict";r.d(t,{$:()=>i});var s=r(5155);r(2115);var n=r(4269);function i(e){let{className:t,variant:r="primary",size:i="md",...a}=e;return(0,s.jsx)("button",{className:(0,n.cn)("inline-flex items-center justify-center rounded-full font-semibold uppercase tracking-wide transition duration-200 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-sky-400 disabled:opacity-60","primary"===r&&"bg-gradient-to-r from-sky-400 via-fuchsia-500 to-emerald-400 text-white shadow-[0_15px_35px_rgba(8,47,73,0.45)] hover:opacity-90","secondary"===r&&"border border-white/15 bg-white/10 text-white shadow-[0_10px_25px_rgba(0,0,0,0.4)] hover:bg-white/20","ghost"===r&&"text-white/80 hover:text-white hover:bg-white/10","destructive"===r&&"bg-gradient-to-r from-rose-500 to-orange-500 text-white shadow-[0_15px_35px_rgba(127,29,29,0.45)] hover:opacity-90","sm"===i&&"px-3.5 py-1.5 text-[11px]","md"===i&&"px-4 py-2 text-sm","lg"===i&&"px-5 py-2.5 text-base",t),...a})}},1289:(e,t,r)=>{"use strict";r.d(t,{N:()=>a});var s=r(2373);let n="https://tosrqizgsvmqxgcmvrgm.supabase.co",i="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InRvc3JxaXpnc3ZtcXhnY212cmdtIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjYwNzg3NTYsImV4cCI6MjA4MTY1NDc1Nn0.3SjpqNotspin0hy4MztwG5uG_AFHSSdhiD47gqmc9G8",a=n&&i?(0,s.UU)(n,i,{auth:{detectSessionInUrl:!0,persistSession:!0}}):null},2417:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>x});var s=r(5155),n=r(2619),i=r.n(n),a=r(5795),l=r(7972),o=r(1166),c=r(5590),d=r(3698),u=r(3449),g=r(2115),h=r(4734);function x(){var e,t,r,n,x;let m=(0,u.Pj)(),p=m.getTargets(),[v,b]=(0,g.useState)(null!=(e=m.getUnits())?e:"lb"),y=m.getOnboarding(),[w,f]=(0,g.useState)(m.getStrengthTrackerEnabled()),[j,N]=(0,g.useState)(()=>{let e=m.getBodyweightOverride();return null==e?"":String(e)}),[S,_]=(0,g.useState)(null!=(t=null==p?void 0:p.calories)?t:2e3),[k,I]=(0,g.useState)(null!=(r=null==p?void 0:p.protein_g)?r:160),[O,C]=(0,g.useState)(null!=(n=null==p?void 0:p.carbs_g)?n:200),[D,T]=(0,g.useState)(null!=(x=null==p?void 0:p.fat_g)?x:60);function z(){m.setUnits(v),m.setTargets({calories:S,protein_g:k,carbs_g:O,fat_g:D}),m.setStrengthTrackerEnabled(w);let e=j.trim()?Number(j):null;m.setBodyweightOverride(Number.isFinite(e)?e:null),h.o.success("Settings saved")}return(0,s.jsxs)("div",{className:"mx-auto max-w-3xl px-4 py-6",children:[(0,s.jsx)(a.V,{title:"Settings",subtitle:"Targets, units, export",right:(0,s.jsx)(i(),{href:"/log",children:(0,s.jsx)(o.$,{variant:"secondary",children:"Back to log"})})}),(0,s.jsxs)("div",{className:"mt-4 grid gap-4",children:[(0,s.jsxs)(l.Z,{children:[(0,s.jsx)("div",{className:"text-sm text-zinc-400",children:"Units"}),(0,s.jsx)("div",{className:"mt-3 max-w-xs",children:(0,s.jsx)(d.l,{label:"Bodyweight units",value:v,onChange:e=>b(e),options:[{value:"lb",label:"lb"},{value:"kg",label:"kg"}]})})]}),(0,s.jsxs)(l.Z,{children:[(0,s.jsx)("div",{className:"text-sm text-zinc-400",children:"Daily targets"}),(0,s.jsxs)("div",{className:"mt-3 grid gap-3 sm:grid-cols-2",children:[(0,s.jsx)(c.p,{label:"Calories",type:"number",value:S,onChange:e=>_(Number(e.target.value))}),(0,s.jsx)(c.p,{label:"Protein (g)",type:"number",value:k,onChange:e=>I(Number(e.target.value))}),(0,s.jsx)(c.p,{label:"Carbs (g)",type:"number",value:O,onChange:e=>C(Number(e.target.value))}),(0,s.jsx)(c.p,{label:"Fat (g)",type:"number",value:D,onChange:e=>T(Number(e.target.value))})]}),(0,s.jsx)("div",{className:"mt-4 flex justify-end",children:(0,s.jsx)(o.$,{onClick:z,children:"Save"})})]}),(0,s.jsxs)(l.Z,{children:[(0,s.jsx)("div",{className:"text-sm text-zinc-400",children:"Strength tracker"}),(0,s.jsxs)("div",{className:"mt-3 grid gap-3 sm:grid-cols-2 sm:items-end",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"text-sm text-zinc-300",children:"Strength Index"}),(0,s.jsx)("div",{className:"mt-1 text-xs text-zinc-500",children:"Computes an estimated 1RM trend from logged weights and normalizes it by bodyweight."}),(0,s.jsx)("div",{className:"mt-3",children:(0,s.jsx)(o.$,{variant:w?"secondary":"ghost",onClick:()=>f(e=>!e),children:w?"Enabled":"Disabled"})})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(c.p,{label:"Bodyweight override (".concat(v,") (optional)"),placeholder:(null==y?void 0:y.weight)?"Using onboarding: ".concat(y.weight," ").concat(y.units):"Set in onboarding",value:j,onChange:e=>N(e.target.value)}),(0,s.jsx)("div",{className:"mt-1 text-xs text-zinc-500",children:"Leave blank to use your onboarding bodyweight."})]})]}),(0,s.jsx)("div",{className:"mt-4 flex justify-end",children:(0,s.jsx)(o.$,{onClick:z,children:"Save"})})]}),(0,s.jsxs)(l.Z,{children:[(0,s.jsx)("div",{className:"text-sm text-zinc-400",children:"Data"}),(0,s.jsxs)("div",{className:"mt-3 flex flex-col gap-2 sm:flex-row",children:[(0,s.jsx)(o.$,{variant:"secondary",onClick:()=>{let e=new Blob([JSON.stringify(m.exportAll(),null,2)],{type:"application/json"}),t=URL.createObjectURL(e),r=document.createElement("a");r.href=t,r.download="flexlog-export.json",r.click(),URL.revokeObjectURL(t)},children:"Export JSON"}),(0,s.jsx)(o.$,{variant:"destructive",onClick:()=>{confirm("Delete all local data?")&&(m.clearAll(),h.o.success("Local data cleared"),location.href="/")},children:"Delete local data"})]})]})]})]})}},3449:(e,t,r)=>{"use strict";r.d(t,{P_:()=>h,Pj:()=>f,n4:()=>w});var s=r(1289),n=r(4986);let i="flexlog:v1",a="flexlog:device-id",l="user_snapshots",o=null,c=null,d=null,u=null,g=null;function h(e){g=e}function x(e){return JSON.parse(JSON.stringify(e))}async function m(e){1;try{await fetch("/api/storage/snapshot",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({deviceId:function(){try{let e=localStorage.getItem(a);if(e)return e;return e="undefined"!=typeof crypto&&"randomUUID"in crypto?crypto.randomUUID():Math.random().toString(36).slice(2),localStorage.setItem(a,e),e}catch(e){return"fallback-device"}}(),state:e})})}catch(e){console.warn("Failed to sync Supabase snapshot",e)}}async function p(e){if(g&&s.N)try{let{error:t}=await s.N.from(l).upsert({user_id:g,state:e,updated_at:new Date().toISOString()});t&&console.warn("Failed to sync user snapshot",t)}catch(e){console.warn("Failed to sync user snapshot",e)}}function v(e){1;if(g&&s.N){if(d=x(e),u)return;u=window.setTimeout(()=>{u=null,d&&p(d).catch(()=>{})},1e3);return}o=x(e),c||(c=window.setTimeout(()=>{c=null,o&&m(o).catch(()=>{})},1e3))}function b(){return{units:"lb",selectedDate:(0,n.GP)(new Date,"yyyy-MM-dd"),onboarding:null,targets:null,logs:{},workoutDays:[],indicators:{},strengthTrackerEnabled:!0,bodyweightOverride:null,weightLogs:{}}}function y(){try{let e=localStorage.getItem(i);if(!e)return b();let t=JSON.parse(e);return{...b(),...t}}catch(e){return b()}}async function w(e){if(!s.N)return{synced:!1,reason:"supabase_not_configured"};g=e;let{data:t,error:r}=await s.N.from(l).select("state").eq("user_id",e).maybeSingle();return r?(console.warn("Failed to fetch user snapshot",r),{synced:!1,reason:"fetch_error"}):(null==t?void 0:t.state)?(localStorage.setItem(i,JSON.stringify(t.state)),v(t.state),{synced:!0,reason:"loaded_remote"}):(v(y()),{synced:!0,reason:"no_remote"})}function f(){let e=()=>y(),t=t=>{let r=t(e());return localStorage.setItem(i,JSON.stringify(r)),v(r),r};return{exportAll:()=>e(),clearAll:()=>localStorage.removeItem(i),getUnits:()=>e().units,setUnits:e=>t(t=>({...t,units:e})),getSelectedDate:()=>e().selectedDate,setSelectedDate:e=>t(t=>({...t,selectedDate:e})),getOnboarding:()=>e().onboarding,setOnboarding:e=>t(t=>({...t,onboarding:e})),getTargets:()=>e().targets,setTargets:e=>t(t=>({...t,targets:e})),getDailyLog:t=>{var r;return null!=(r=e().logs[t])?r:{date:t,mealGroups:[]}},setDailyLog:e=>t(t=>({...t,logs:{...t.logs,[e.date]:e},indicators:{...t.indicators,[e.date]:"dot"}})),addFoodItem:(e,r,s)=>t(t=>{var n;let i=null!=(n=t.logs[e])?n:{date:e,mealGroups:[]},a=i.mealGroups.map(e=>e.id===r?{...e,items:[...e.items,s]}:e),l={...i,mealGroups:a};return{...t,logs:{...t.logs,[e]:l},indicators:{...t.indicators,[e]:"dot"}}}),getDayIndicator:t=>{var r;return null!=(r=e().indicators[t])?r:"none"},getWorkoutDays:()=>e().workoutDays,setWorkoutDays:e=>t(t=>({...t,workoutDays:e})),getStrengthTrackerEnabled:()=>{var t;return null==(t=e().strengthTrackerEnabled)||t},setStrengthTrackerEnabled:e=>t(t=>({...t,strengthTrackerEnabled:e})),getBodyweightOverride:()=>{var t;return null!=(t=e().bodyweightOverride)?t:null},setBodyweightOverride:e=>t(t=>({...t,bodyweightOverride:e})),bumpWorkoutIndicator:e=>t(t=>({...t,indicators:{...t.indicators,[e]:"dot"}})),syncSnapshotsNow:()=>m(e()),getWeightLogs:()=>{var t;return null!=(t=e().weightLogs)?t:{}},setWeightLog:(e,r)=>t(t=>({...t,weightLogs:{...t.weightLogs,[e]:r}})),removeWeightLog:e=>t(t=>{let r={...t.weightLogs};return delete r[e],{...t,weightLogs:r}})}}},3698:(e,t,r)=>{"use strict";r.d(t,{l:()=>i});var s=r(5155),n=r(4269);function i(e){let{label:t,value:r,onChange:i,options:a,className:l,disabled:o}=e;return(0,s.jsxs)("label",{className:(0,n.cn)("block space-y-2",l,o&&"opacity-60"),children:[t?(0,s.jsx)("div",{className:"text-[10px] uppercase tracking-[0.35em] text-white/60",children:t}):null,(0,s.jsx)("select",{disabled:o,className:(0,n.cn)("w-full rounded-2xl border border-white/10 bg-white/10 px-4 py-3 text-sm text-white outline-none transition focus:border-white/40",o&&"cursor-not-allowed opacity-70"),value:r,onChange:e=>i(e.target.value),children:a.map(e=>(0,s.jsx)("option",{value:e.value,children:e.label},e.value))})]})}r(2115)},4269:(e,t,r)=>{"use strict";r.d(t,{cn:()=>i,s:()=>a});var s=r(2821),n=r(5889);function i(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return(0,n.QP)((0,s.$)(t))}function a(e,t){let r;return function(){for(var s=arguments.length,n=Array(s),i=0;i<s;i++)n[i]=arguments[i];clearTimeout(r),r=setTimeout(()=>e(...n),t)}}},4734:(e,t,r)=>{"use strict";r.d(t,{l:()=>o,o:()=>c});var s=r(5155),n=r(2115),i=r(1408),a=r(4486);let l=(0,n.createContext)(null);function o(){let[e,t]=(0,n.useState)([]),r=(0,n.useMemo)(()=>({push:e=>{let r={...e,id:crypto.randomUUID()};t(e=>[...e,r]),setTimeout(()=>{t(e=>e.filter(e=>e.id!==r.id))},2600)}}),[]);return(0,n.useEffect)(()=>{window.__flexlog_toast=r},[r]),(0,s.jsx)(l.Provider,{value:r,children:(0,s.jsx)("div",{className:"pointer-events-none fixed right-4 top-4 z-[100] w-[340px] max-w-[calc(100vw-2rem)] space-y-2",children:(0,s.jsx)(i.N,{children:e.map(e=>(0,s.jsx)(a.P.div,{initial:{opacity:0,y:-10,scale:.98},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:-10,scale:.98},transition:{duration:.18},className:["pointer-events-auto rounded-2xl border p-3 backdrop-blur","success"===e.type&&"border-emerald-900/60 bg-emerald-950/40","error"===e.type&&"border-red-900/60 bg-red-950/40","info"===e.type&&"border-zinc-800 bg-zinc-950/60"].join(" "),children:(0,s.jsx)("div",{className:"text-sm text-zinc-100",children:e.message})},e.id))})})})}let c={success:e=>{var t;return null==(t=window.__flexlog_toast)?void 0:t.push({type:"success",message:e})},error:e=>{var t;return null==(t=window.__flexlog_toast)?void 0:t.push({type:"error",message:e})},info:e=>{var t;return null==(t=window.__flexlog_toast)?void 0:t.push({type:"info",message:e})}}},5590:(e,t,r)=>{"use strict";r.d(t,{p:()=>i});var s=r(5155);r(2115);var n=r(4269);function i(e){let{label:t,className:r,disabled:i,...a}=e;return(0,s.jsxs)("label",{className:(0,n.cn)("block space-y-2",r,i&&"opacity-60"),children:[t?(0,s.jsx)("div",{className:"text-[10px] uppercase tracking-[0.35em] text-white/60",children:t}):null,(0,s.jsx)("input",{disabled:i,className:(0,n.cn)("w-full rounded-2xl border border-white/10 bg-white/10 px-4 py-3 text-sm text-white placeholder:text-white/40 transition focus:border-white/40 focus:outline-none",i&&"cursor-not-allowed opacity-70"),...a})]})}},5795:(e,t,r)=>{"use strict";r.d(t,{V:()=>l});var s=r(5155),n=r(2115),i=r(4486),a=r(4269);function l(e){let{title:t,subtitle:r,right:l,className:o}=e,[c,d]=(0,n.useState)(!1);return(0,n.useEffect)(()=>{let e=()=>d(window.scrollY>8);return e(),window.addEventListener("scroll",e,{passive:!0}),()=>window.removeEventListener("scroll",e)},[]),(0,s.jsx)(i.P.div,{className:(0,a.cn)("sticky top-0 z-30 rounded-3xl border border-white/10 bg-white/5 px-4 py-4 backdrop-blur-xl shadow-[0_20px_60px_rgba(2,4,13,0.55)]",c?"border-white/15 bg-white/10":"",o),animate:{paddingTop:c?12:16,paddingBottom:c?12:16},transition:{duration:.18},children:(0,s.jsxs)("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"text-sm text-zinc-400",children:r}),(0,s.jsx)("div",{className:"text-xl font-semibold tracking-tight",children:t})]}),l?(0,s.jsx)("div",{children:l}):null]})})}},6489:(e,t,r)=>{Promise.resolve().then(r.bind(r,2417))},7972:(e,t,r)=>{"use strict";r.d(t,{Z:()=>i});var s=r(5155);r(2115);var n=r(4269);function i(e){let{className:t,children:r}=e;return(0,s.jsx)("div",{className:(0,n.cn)("w-full rounded-[28px] border border-white/10 bg-white/5 p-5 shadow-[0_30px_80px_rgba(2,4,13,0.65)] backdrop-blur-xl transition-colors duration-200 hover:border-white/20 sm:p-6",t),children:r})}}},e=>{e.O(0,[909,970,619,441,255,358],()=>e(e.s=6489)),_N_E=e.O()}]);