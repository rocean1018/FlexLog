(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[365],{1166:(e,t,r)=>{"use strict";r.d(t,{$:()=>i});var n=r(5155);r(2115);var s=r(4269);function i(e){let{className:t,variant:r="primary",size:i="md",...a}=e;return(0,n.jsx)("button",{className:(0,s.cn)("inline-flex items-center justify-center rounded-full font-semibold uppercase tracking-wide transition duration-200 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-sky-400 disabled:opacity-60","primary"===r&&"bg-gradient-to-r from-sky-400 via-fuchsia-500 to-emerald-400 text-white shadow-[0_15px_35px_rgba(8,47,73,0.45)] hover:opacity-90","secondary"===r&&"border border-white/15 bg-white/10 text-white shadow-[0_10px_25px_rgba(0,0,0,0.4)] hover:bg-white/20","ghost"===r&&"text-white/80 hover:text-white hover:bg-white/10","destructive"===r&&"bg-gradient-to-r from-rose-500 to-orange-500 text-white shadow-[0_15px_35px_rgba(127,29,29,0.45)] hover:opacity-90","sm"===i&&"px-3.5 py-1.5 text-[11px]","md"===i&&"px-4 py-2 text-sm","lg"===i&&"px-5 py-2.5 text-base",t),...a})}},1289:(e,t,r)=>{"use strict";r.d(t,{N:()=>a});var n=r(2373);let s="https://tosrqizgsvmqxgcmvrgm.supabase.co",i="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InRvc3JxaXpnc3ZtcXhnY212cmdtIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjYwNzg3NTYsImV4cCI6MjA4MTY1NDc1Nn0.3SjpqNotspin0hy4MztwG5uG_AFHSSdhiD47gqmc9G8",a=s&&i?(0,n.UU)(s,i,{auth:{detectSessionInUrl:!0,persistSession:!0}}):null},1774:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>h});var n=r(5155),s=r(2115),i=r(2619),a=r.n(i),o=r(5795),l=r(7972),c=r(5590),u=r(1166),d=r(9016),g=r(4734);function h(){let{signIn:e,signUp:t,signOut:r,user:i,supabaseAvailable:h}=(0,d.A)(),[p,m]=(0,s.useState)("signup"),[x,f]=(0,s.useState)(""),[v,y]=(0,s.useState)(""),[b,w]=(0,s.useState)(!1);async function N(r){if(r.preventDefault(),!h)return void g.o.error("Supabase auth is not configured.");w(!0);let{error:n}=await ("signup"===p?t:e)(x,v);w(!1),n?g.o.error(n):g.o.success("signup"===p?"Check your email to confirm your account.":"Welcome back!")}async function S(){w(!0);let{error:e}=await r();w(!1),e?g.o.error(e):g.o.success("Signed out")}return(0,n.jsxs)("div",{className:"mx-auto max-w-lg px-4 py-6",children:[(0,n.jsx)(o.V,{title:"Account",subtitle:i?"Signed in as ".concat(i.email):"Create an account or sign in",right:(0,n.jsx)(a(),{href:"/log",children:(0,n.jsx)(u.$,{variant:"secondary",children:"Back to log"})})}),(0,n.jsxs)(l.Z,{children:[h?null:(0,n.jsxs)("div",{className:"text-sm text-zinc-400",children:["Set ",(0,n.jsx)("span",{className:"text-zinc-200",children:"NEXT_PUBLIC_SUPABASE_URL"})," and ",(0,n.jsx)("span",{className:"text-zinc-200",children:"NEXT_PUBLIC_SUPABASE_ANON_KEY"})," to enable Supabase Auth."]}),i?(0,n.jsxs)("div",{className:"flex flex-col gap-3",children:[(0,n.jsxs)("div",{className:"rounded-2xl bg-zinc-950/40 p-4 ring-1 ring-zinc-800",children:[(0,n.jsx)("div",{className:"text-sm text-zinc-400",children:"Currently signed in"}),(0,n.jsx)("div",{className:"text-lg font-semibold",children:i.email})]}),(0,n.jsx)(u.$,{variant:"destructive",onClick:S,disabled:b,children:"Sign out"})]}):(0,n.jsxs)("form",{className:"grid gap-4",onSubmit:N,children:[(0,n.jsxs)("div",{className:"flex gap-2",children:[(0,n.jsx)(u.$,{type:"button",variant:"signup"===p?"primary":"ghost",onClick:()=>m("signup"),className:"flex-1",children:"Create account"}),(0,n.jsx)(u.$,{type:"button",variant:"signin"===p?"primary":"ghost",onClick:()=>m("signin"),className:"flex-1",children:"Sign in"})]}),(0,n.jsx)(c.p,{label:"Email",type:"email",required:!0,value:x,onChange:e=>f(e.target.value),placeholder:"you@example.com"}),(0,n.jsx)(c.p,{label:"Password",type:"password",required:!0,value:v,onChange:e=>y(e.target.value),placeholder:"At least 6 characters"}),(0,n.jsx)(u.$,{type:"submit",disabled:b||!h,children:"signup"===p?"Create account":"Sign in"}),"signup"===p?(0,n.jsx)("p",{className:"text-xs text-zinc-500",children:"You'll receive a confirmation email. The account becomes active once confirmed."}):null]})]})]})}},3449:(e,t,r)=>{"use strict";r.d(t,{P_:()=>h,Pj:()=>w,n4:()=>b});var n=r(1289),s=r(4986);let i="flexlog:v1",a="flexlog:device-id",o="user_snapshots",l=null,c=null,u=null,d=null,g=null;function h(e){g=e}function p(e){return JSON.parse(JSON.stringify(e))}async function m(e){1;try{await fetch("/api/storage/snapshot",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({deviceId:function(){try{let e=localStorage.getItem(a);if(e)return e;return e="undefined"!=typeof crypto&&"randomUUID"in crypto?crypto.randomUUID():Math.random().toString(36).slice(2),localStorage.setItem(a,e),e}catch(e){return"fallback-device"}}(),state:e})})}catch(e){console.warn("Failed to sync Supabase snapshot",e)}}async function x(e){if(g&&n.N)try{let{error:t}=await n.N.from(o).upsert({user_id:g,state:e,updated_at:new Date().toISOString()});t&&console.warn("Failed to sync user snapshot",t)}catch(e){console.warn("Failed to sync user snapshot",e)}}function f(e){1;if(g&&n.N){if(u=p(e),d)return;d=window.setTimeout(()=>{d=null,u&&x(u).catch(()=>{})},1e3);return}l=p(e),c||(c=window.setTimeout(()=>{c=null,l&&m(l).catch(()=>{})},1e3))}function v(){return{units:"lb",selectedDate:(0,s.GP)(new Date,"yyyy-MM-dd"),onboarding:null,targets:null,logs:{},workoutDays:[],indicators:{},strengthTrackerEnabled:!0,bodyweightOverride:null,weightLogs:{}}}function y(){try{let e=localStorage.getItem(i);if(!e)return v();let t=JSON.parse(e);return{...v(),...t}}catch(e){return v()}}async function b(e){if(!n.N)return{synced:!1,reason:"supabase_not_configured"};g=e;let{data:t,error:r}=await n.N.from(o).select("state").eq("user_id",e).maybeSingle();return r?(console.warn("Failed to fetch user snapshot",r),{synced:!1,reason:"fetch_error"}):(null==t?void 0:t.state)?(localStorage.setItem(i,JSON.stringify(t.state)),f(t.state),{synced:!0,reason:"loaded_remote"}):(f(y()),{synced:!0,reason:"no_remote"})}function w(){let e=()=>y(),t=t=>{let r=t(e());return localStorage.setItem(i,JSON.stringify(r)),f(r),r};return{exportAll:()=>e(),clearAll:()=>localStorage.removeItem(i),getUnits:()=>e().units,setUnits:e=>t(t=>({...t,units:e})),getSelectedDate:()=>e().selectedDate,setSelectedDate:e=>t(t=>({...t,selectedDate:e})),getOnboarding:()=>e().onboarding,setOnboarding:e=>t(t=>({...t,onboarding:e})),getTargets:()=>e().targets,setTargets:e=>t(t=>({...t,targets:e})),getDailyLog:t=>{var r;return null!=(r=e().logs[t])?r:{date:t,mealGroups:[]}},setDailyLog:e=>t(t=>({...t,logs:{...t.logs,[e.date]:e},indicators:{...t.indicators,[e.date]:"dot"}})),addFoodItem:(e,r,n)=>t(t=>{var s;let i=null!=(s=t.logs[e])?s:{date:e,mealGroups:[]},a=i.mealGroups.map(e=>e.id===r?{...e,items:[...e.items,n]}:e),o={...i,mealGroups:a};return{...t,logs:{...t.logs,[e]:o},indicators:{...t.indicators,[e]:"dot"}}}),getDayIndicator:t=>{var r;return null!=(r=e().indicators[t])?r:"none"},getWorkoutDays:()=>e().workoutDays,setWorkoutDays:e=>t(t=>({...t,workoutDays:e})),getStrengthTrackerEnabled:()=>{var t;return null==(t=e().strengthTrackerEnabled)||t},setStrengthTrackerEnabled:e=>t(t=>({...t,strengthTrackerEnabled:e})),getBodyweightOverride:()=>{var t;return null!=(t=e().bodyweightOverride)?t:null},setBodyweightOverride:e=>t(t=>({...t,bodyweightOverride:e})),bumpWorkoutIndicator:e=>t(t=>({...t,indicators:{...t.indicators,[e]:"dot"}})),syncSnapshotsNow:()=>m(e()),getWeightLogs:()=>{var t;return null!=(t=e().weightLogs)?t:{}},setWeightLog:(e,r)=>t(t=>({...t,weightLogs:{...t.weightLogs,[e]:r}})),removeWeightLog:e=>t(t=>{let r={...t.weightLogs};return delete r[e],{...t,weightLogs:r}})}}},4269:(e,t,r)=>{"use strict";r.d(t,{cn:()=>i,s:()=>a});var n=r(2821),s=r(5889);function i(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return(0,s.QP)((0,n.$)(t))}function a(e,t){let r;return function(){for(var n=arguments.length,s=Array(n),i=0;i<n;i++)s[i]=arguments[i];clearTimeout(r),r=setTimeout(()=>e(...s),t)}}},4734:(e,t,r)=>{"use strict";r.d(t,{l:()=>l,o:()=>c});var n=r(5155),s=r(2115),i=r(1408),a=r(4486);let o=(0,s.createContext)(null);function l(){let[e,t]=(0,s.useState)([]),r=(0,s.useMemo)(()=>({push:e=>{let r={...e,id:crypto.randomUUID()};t(e=>[...e,r]),setTimeout(()=>{t(e=>e.filter(e=>e.id!==r.id))},2600)}}),[]);return(0,s.useEffect)(()=>{window.__flexlog_toast=r},[r]),(0,n.jsx)(o.Provider,{value:r,children:(0,n.jsx)("div",{className:"pointer-events-none fixed right-4 top-4 z-[100] w-[340px] max-w-[calc(100vw-2rem)] space-y-2",children:(0,n.jsx)(i.N,{children:e.map(e=>(0,n.jsx)(a.P.div,{initial:{opacity:0,y:-10,scale:.98},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:-10,scale:.98},transition:{duration:.18},className:["pointer-events-auto rounded-2xl border p-3 backdrop-blur","success"===e.type&&"border-emerald-900/60 bg-emerald-950/40","error"===e.type&&"border-red-900/60 bg-red-950/40","info"===e.type&&"border-zinc-800 bg-zinc-950/60"].join(" "),children:(0,n.jsx)("div",{className:"text-sm text-zinc-100",children:e.message})},e.id))})})})}let c={success:e=>{var t;return null==(t=window.__flexlog_toast)?void 0:t.push({type:"success",message:e})},error:e=>{var t;return null==(t=window.__flexlog_toast)?void 0:t.push({type:"error",message:e})},info:e=>{var t;return null==(t=window.__flexlog_toast)?void 0:t.push({type:"info",message:e})}}},5590:(e,t,r)=>{"use strict";r.d(t,{p:()=>i});var n=r(5155);r(2115);var s=r(4269);function i(e){let{label:t,className:r,disabled:i,...a}=e;return(0,n.jsxs)("label",{className:(0,s.cn)("block space-y-2",r,i&&"opacity-60"),children:[t?(0,n.jsx)("div",{className:"text-[10px] uppercase tracking-[0.35em] text-white/60",children:t}):null,(0,n.jsx)("input",{disabled:i,className:(0,s.cn)("w-full rounded-2xl border border-white/10 bg-white/10 px-4 py-3 text-sm text-white placeholder:text-white/40 transition focus:border-white/40 focus:outline-none",i&&"cursor-not-allowed opacity-70"),...a})]})}},5795:(e,t,r)=>{"use strict";r.d(t,{V:()=>o});var n=r(5155),s=r(2115),i=r(4486),a=r(4269);function o(e){let{title:t,subtitle:r,right:o,className:l}=e,[c,u]=(0,s.useState)(!1);return(0,s.useEffect)(()=>{let e=()=>u(window.scrollY>8);return e(),window.addEventListener("scroll",e,{passive:!0}),()=>window.removeEventListener("scroll",e)},[]),(0,n.jsx)(i.P.div,{className:(0,a.cn)("sticky top-0 z-30 rounded-3xl border border-white/10 bg-white/5 px-4 py-4 backdrop-blur-xl shadow-[0_20px_60px_rgba(2,4,13,0.55)]",c?"border-white/15 bg-white/10":"",l),animate:{paddingTop:c?12:16,paddingBottom:c?12:16},transition:{duration:.18},children:(0,n.jsxs)("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:"text-sm text-zinc-400",children:r}),(0,n.jsx)("div",{className:"text-xl font-semibold tracking-tight",children:t})]}),o?(0,n.jsx)("div",{children:o}):null]})})}},7972:(e,t,r)=>{"use strict";r.d(t,{Z:()=>i});var n=r(5155);r(2115);var s=r(4269);function i(e){let{className:t,children:r}=e;return(0,n.jsx)("div",{className:(0,s.cn)("w-full rounded-[28px] border border-white/10 bg-white/5 p-5 shadow-[0_30px_80px_rgba(2,4,13,0.65)] backdrop-blur-xl transition-colors duration-200 hover:border-white/20 sm:p-6",t),children:r})}},9016:(e,t,r)=>{"use strict";r.d(t,{A:()=>c,O:()=>l});var n=r(5155),s=r(2115),i=r(1289),a=r(3449);let o=(0,s.createContext)({session:null,user:null,loading:!1,ready:!1,supabaseAvailable:!!i.N,signUp:async()=>({error:"Auth not configured"}),signIn:async()=>({error:"Auth not configured"}),signOut:async()=>({error:"Auth not configured"})});function l(e){let{children:t}=e,[r,l]=(0,s.useState)(null),[c,u]=(0,s.useState)(null),[d,g]=(0,s.useState)(!1),h=!!i.N;(0,s.useEffect)(()=>{if(!i.N)return void g(!0);let e=!1;i.N.auth.getSession().then(t=>{var r,n;let{data:s}=t;e||(l(s.session),u(null!=(n=null==(r=s.session)?void 0:r.user)?n:null),g(!0))});let{data:{subscription:t}}=i.N.auth.onAuthStateChange((e,t)=>{var r;l(t),u(null!=(r=null==t?void 0:t.user)?r:null)});return()=>{e=!0,t.unsubscribe()}},[]);let p=(!d||!h)&&!d,m=(0,s.useMemo)(()=>({session:r,user:c,loading:p,ready:d,supabaseAvailable:h,signUp:async(e,t)=>{if(!i.N)return{error:"Auth not configured"};let{error:r}=await i.N.auth.signUp({email:e,password:t});return{error:null==r?void 0:r.message}},signIn:async(e,t)=>{if(!i.N)return{error:"Auth not configured"};let{error:r}=await i.N.auth.signInWithPassword({email:e,password:t});return{error:null==r?void 0:r.message}},signOut:async()=>{if(!i.N)return{error:"Auth not configured"};let{error:e}=await i.N.auth.signOut();return{error:null==e?void 0:e.message}}}),[r,c,p,d,h]);return(0,s.useEffect)(()=>{var e;(0,a.P_)(null!=(e=null==c?void 0:c.id)?e:null),(null==c?void 0:c.id)&&(0,a.n4)(c.id).catch(e=>{console.warn("Failed to hydrate store for user",e)})},[null==c?void 0:c.id]),(0,n.jsx)(o.Provider,{value:m,children:t})}function c(){return(0,s.useContext)(o)}},9760:(e,t,r)=>{Promise.resolve().then(r.bind(r,1774))}},e=>{e.O(0,[909,970,619,441,255,358],()=>e(e.s=9760)),_N_E=e.O()}]);