(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[177],{63:(e,t,r)=>{"use strict";var n=r(7260);r.o(n,"usePathname")&&r.d(t,{usePathname:function(){return n.usePathname}}),r.o(n,"useSearchParams")&&r.d(t,{useSearchParams:function(){return n.useSearchParams}})},383:(e,t,r)=>{"use strict";r.d(t,{A:()=>n});let n=(0,r(1847).A)("CalendarDays",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M8 18h.01",key:"lrp35t"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M16 18h.01",key:"kzsmim"}]])},1289:(e,t,r)=>{"use strict";r.d(t,{N:()=>l});var n=r(2373);let a="https://tosrqizgsvmqxgcmvrgm.supabase.co",s="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InRvc3JxaXpnc3ZtcXhnY212cmdtIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjYwNzg3NTYsImV4cCI6MjA4MTY1NDc1Nn0.3SjpqNotspin0hy4MztwG5uG_AFHSSdhiD47gqmc9G8",l=a&&s?(0,n.UU)(a,s,{auth:{detectSessionInUrl:!0,persistSession:!0}}):null},1847:(e,t,r)=>{"use strict";r.d(t,{A:()=>i});var n=r(2115);let a=function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return t.filter((e,t,r)=>!!e&&""!==e.trim()&&r.indexOf(e)===t).join(" ").trim()};var s={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let l=(0,n.forwardRef)((e,t)=>{let{color:r="currentColor",size:l=24,strokeWidth:i=2,absoluteStrokeWidth:o,className:c="",children:d,iconNode:u,...h}=e;return(0,n.createElement)("svg",{ref:t,...s,width:l,height:l,stroke:r,strokeWidth:o?24*Number(i)/Number(l):i,className:a("lucide",c),...h},[...u.map(e=>{let[t,r]=e;return(0,n.createElement)(t,r)}),...Array.isArray(d)?d:[d]])}),i=(e,t)=>{let r=(0,n.forwardRef)((r,s)=>{let{className:i,...o}=r;return(0,n.createElement)(l,{ref:s,iconNode:t,className:a("lucide-".concat(e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase()),i),...o})});return r.displayName="".concat(e),r}},2916:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>v});var n=r(5155);r(3673);var a=r(2619),s=r.n(a),l=r(63),i=r(4269),o=r(1847);let c=(0,o.A)("Flame",[["path",{d:"M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a7 7 0 1 1-14 0c0-1.153.433-2.294 1-3a2.5 2.5 0 0 0 2.5 2.5z",key:"96xj49"}]]);var d=r(383),u=r(4982);let h=(0,o.A)("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);var g=r(9016);let m=[{href:"/log",label:"Log",icon:c},{href:"/foods",label:"Foods",icon:d.A},{href:"/workouts",label:"Workouts",icon:u.A},{href:"/settings",label:"Settings",icon:h}];function p(e){let{children:t}=e,r=(0,l.usePathname)(),{user:a,supabaseAvailable:o}=(0,g.A)();return(0,n.jsx)("div",{className:"min-h-screen",children:(0,n.jsx)("div",{className:"mx-auto max-w-7xl",children:(0,n.jsxs)("div",{className:"grid min-h-screen grid-rows-[1fr] lg:grid-cols-[260px,1fr]",children:[(0,n.jsxs)("aside",{className:"sticky top-0 hidden h-screen border-r border-zinc-900 bg-zinc-950/50 p-4 backdrop-blur lg:block",children:[(0,n.jsxs)(s(),{href:"/",className:"block rounded-2xl px-3 py-2 hover:bg-zinc-900/40",children:[(0,n.jsx)("div",{className:"text-sm text-zinc-400",children:"FlexLog"}),(0,n.jsx)("div",{className:"text-base font-semibold",children:"Dashboard"})]}),(0,n.jsx)("div",{className:"mt-4 grid gap-1",children:m.map(e=>{let t=null==r?void 0:r.startsWith(e.href),a=e.icon;return(0,n.jsxs)(s(),{href:e.href,className:(0,i.cn)("flex items-center gap-3 rounded-2xl px-3 py-2 text-sm transition",t?"bg-zinc-900/50 ring-1 ring-zinc-800":"hover:bg-zinc-900/30"),children:[(0,n.jsx)(a,{className:"h-4 w-4 text-zinc-300"}),(0,n.jsx)("span",{children:e.label})]},e.href)})}),(0,n.jsxs)("div",{className:"mt-6 space-y-1 text-xs text-zinc-500",children:[(0,n.jsxs)("div",{children:["Guest mode by default. ",o?"Supabase Auth enabled.":"Add Supabase keys to enable accounts."]}),(0,n.jsx)("div",{className:"text-sm",children:a?(0,n.jsxs)("span",{className:"text-zinc-300",children:["Signed in as ",a.email]}):(0,n.jsx)(s(),{href:"/auth",className:"text-zinc-200 underline",children:"Create an account / sign in"})})]})]}),(0,n.jsxs)("main",{className:"pb-10",children:[(0,n.jsx)("div",{className:"lg:hidden",children:(0,n.jsx)(f,{})}),t]})]})})})}function f(){let e=(0,l.usePathname)();return(0,n.jsx)("div",{className:"sticky top-0 z-40 border-b border-zinc-900 bg-zinc-950/70 px-4 py-3 backdrop-blur",children:(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsx)(s(),{href:"/",className:"font-semibold tracking-tight",children:"FlexLog"}),(0,n.jsx)("div",{className:"flex items-center gap-1",children:m.map(t=>{let r=null==e?void 0:e.startsWith(t.href),a=t.icon;return(0,n.jsx)(s(),{href:t.href,className:(0,i.cn)("grid h-10 w-10 place-items-center rounded-2xl transition",r?"bg-zinc-900/60 ring-1 ring-zinc-800":"hover:bg-zinc-900/30"),title:t.label,children:(0,n.jsx)(a,{className:"h-4 w-4"})},t.href)})})]})})}var y=r(4734);function v(e){let{children:t}=e;return(0,n.jsx)("html",{lang:"en",className:"dark",children:(0,n.jsxs)("body",{children:[(0,n.jsx)(g.O,{children:(0,n.jsx)(p,{children:t})}),(0,n.jsx)(y.l,{})]})})}},3449:(e,t,r)=>{"use strict";r.d(t,{P_:()=>g,Pj:()=>w,n4:()=>b});var n=r(1289),a=r(4986);let s="flexlog:v1",l="flexlog:device-id",i="user_snapshots",o=null,c=null,d=null,u=null,h=null;function g(e){h=e}function m(e){return JSON.parse(JSON.stringify(e))}async function p(e){1;try{await fetch("/api/storage/snapshot",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({deviceId:function(){try{let e=localStorage.getItem(l);if(e)return e;return e="undefined"!=typeof crypto&&"randomUUID"in crypto?crypto.randomUUID():Math.random().toString(36).slice(2),localStorage.setItem(l,e),e}catch(e){return"fallback-device"}}(),state:e})})}catch(e){console.warn("Failed to sync Supabase snapshot",e)}}async function f(e){if(h&&n.N)try{let{error:t}=await n.N.from(i).upsert({user_id:h,state:e,updated_at:new Date().toISOString()});t&&console.warn("Failed to sync user snapshot",t)}catch(e){console.warn("Failed to sync user snapshot",e)}}function y(e){1;if(h&&n.N){if(d=m(e),u)return;u=window.setTimeout(()=>{u=null,d&&f(d).catch(()=>{})},1e3);return}o=m(e),c||(c=window.setTimeout(()=>{c=null,o&&p(o).catch(()=>{})},1e3))}function v(){return{units:"lb",selectedDate:(0,a.GP)(new Date,"yyyy-MM-dd"),onboarding:null,targets:null,logs:{},workoutDays:[],indicators:{},strengthTrackerEnabled:!0,bodyweightOverride:null,weightLogs:{}}}function x(){try{let e=localStorage.getItem(s);if(!e)return v();let t=JSON.parse(e);return{...v(),...t}}catch(e){return v()}}async function b(e){if(!n.N)return{synced:!1,reason:"supabase_not_configured"};h=e;let{data:t,error:r}=await n.N.from(i).select("state").eq("user_id",e).maybeSingle();return r?(console.warn("Failed to fetch user snapshot",r),{synced:!1,reason:"fetch_error"}):(null==t?void 0:t.state)?(localStorage.setItem(s,JSON.stringify(t.state)),y(t.state),{synced:!0,reason:"loaded_remote"}):(y(x()),{synced:!0,reason:"no_remote"})}function w(){let e=()=>x(),t=t=>{let r=t(e());return localStorage.setItem(s,JSON.stringify(r)),y(r),r};return{exportAll:()=>e(),clearAll:()=>localStorage.removeItem(s),getUnits:()=>e().units,setUnits:e=>t(t=>({...t,units:e})),getSelectedDate:()=>e().selectedDate,setSelectedDate:e=>t(t=>({...t,selectedDate:e})),getOnboarding:()=>e().onboarding,setOnboarding:e=>t(t=>({...t,onboarding:e})),getTargets:()=>e().targets,setTargets:e=>t(t=>({...t,targets:e})),getDailyLog:t=>{var r;return null!=(r=e().logs[t])?r:{date:t,mealGroups:[]}},setDailyLog:e=>t(t=>({...t,logs:{...t.logs,[e.date]:e},indicators:{...t.indicators,[e.date]:"dot"}})),addFoodItem:(e,r,n)=>t(t=>{var a;let s=null!=(a=t.logs[e])?a:{date:e,mealGroups:[]},l=s.mealGroups.map(e=>e.id===r?{...e,items:[...e.items,n]}:e),i={...s,mealGroups:l};return{...t,logs:{...t.logs,[e]:i},indicators:{...t.indicators,[e]:"dot"}}}),getDayIndicator:t=>{var r;return null!=(r=e().indicators[t])?r:"none"},getWorkoutDays:()=>e().workoutDays,setWorkoutDays:e=>t(t=>({...t,workoutDays:e})),getStrengthTrackerEnabled:()=>{var t;return null==(t=e().strengthTrackerEnabled)||t},setStrengthTrackerEnabled:e=>t(t=>({...t,strengthTrackerEnabled:e})),getBodyweightOverride:()=>{var t;return null!=(t=e().bodyweightOverride)?t:null},setBodyweightOverride:e=>t(t=>({...t,bodyweightOverride:e})),bumpWorkoutIndicator:e=>t(t=>({...t,indicators:{...t.indicators,[e]:"dot"}})),syncSnapshotsNow:()=>p(e()),getWeightLogs:()=>{var t;return null!=(t=e().weightLogs)?t:{}},setWeightLog:(e,r)=>t(t=>({...t,weightLogs:{...t.weightLogs,[e]:r}})),removeWeightLog:e=>t(t=>{let r={...t.weightLogs};return delete r[e],{...t,weightLogs:r}})}}},3673:()=>{},4269:(e,t,r)=>{"use strict";r.d(t,{cn:()=>s,s:()=>l});var n=r(2821),a=r(5889);function s(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return(0,a.QP)((0,n.$)(t))}function l(e,t){let r;return function(){for(var n=arguments.length,a=Array(n),s=0;s<n;s++)a[s]=arguments[s];clearTimeout(r),r=setTimeout(()=>e(...a),t)}}},4734:(e,t,r)=>{"use strict";r.d(t,{l:()=>o,o:()=>c});var n=r(5155),a=r(2115),s=r(1408),l=r(4486);let i=(0,a.createContext)(null);function o(){let[e,t]=(0,a.useState)([]),r=(0,a.useMemo)(()=>({push:e=>{let r={...e,id:crypto.randomUUID()};t(e=>[...e,r]),setTimeout(()=>{t(e=>e.filter(e=>e.id!==r.id))},2600)}}),[]);return(0,a.useEffect)(()=>{window.__flexlog_toast=r},[r]),(0,n.jsx)(i.Provider,{value:r,children:(0,n.jsx)("div",{className:"pointer-events-none fixed right-4 top-4 z-[100] w-[340px] max-w-[calc(100vw-2rem)] space-y-2",children:(0,n.jsx)(s.N,{children:e.map(e=>(0,n.jsx)(l.P.div,{initial:{opacity:0,y:-10,scale:.98},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:-10,scale:.98},transition:{duration:.18},className:["pointer-events-auto rounded-2xl border p-3 backdrop-blur","success"===e.type&&"border-emerald-900/60 bg-emerald-950/40","error"===e.type&&"border-red-900/60 bg-red-950/40","info"===e.type&&"border-zinc-800 bg-zinc-950/60"].join(" "),children:(0,n.jsx)("div",{className:"text-sm text-zinc-100",children:e.message})},e.id))})})})}let c={success:e=>{var t;return null==(t=window.__flexlog_toast)?void 0:t.push({type:"success",message:e})},error:e=>{var t;return null==(t=window.__flexlog_toast)?void 0:t.push({type:"error",message:e})},info:e=>{var t;return null==(t=window.__flexlog_toast)?void 0:t.push({type:"info",message:e})}}},4982:(e,t,r)=>{"use strict";r.d(t,{A:()=>n});let n=(0,r(1847).A)("Dumbbell",[["path",{d:"M14.4 14.4 9.6 9.6",key:"ic80wn"}],["path",{d:"M18.657 21.485a2 2 0 1 1-2.829-2.828l-1.767 1.768a2 2 0 1 1-2.829-2.829l6.364-6.364a2 2 0 1 1 2.829 2.829l-1.768 1.767a2 2 0 1 1 2.828 2.829z",key:"nnl7wr"}],["path",{d:"m21.5 21.5-1.4-1.4",key:"1f1ice"}],["path",{d:"M3.9 3.9 2.5 2.5",key:"1evmna"}],["path",{d:"M6.404 12.768a2 2 0 1 1-2.829-2.829l1.768-1.767a2 2 0 1 1-2.828-2.829l2.828-2.828a2 2 0 1 1 2.829 2.828l1.767-1.768a2 2 0 1 1 2.829 2.829z",key:"yhosts"}]])},8948:(e,t,r)=>{Promise.resolve().then(r.bind(r,2916))},9016:(e,t,r)=>{"use strict";r.d(t,{A:()=>c,O:()=>o});var n=r(5155),a=r(2115),s=r(1289),l=r(3449);let i=(0,a.createContext)({session:null,user:null,loading:!1,ready:!1,supabaseAvailable:!!s.N,signUp:async()=>({error:"Auth not configured"}),signIn:async()=>({error:"Auth not configured"}),signOut:async()=>({error:"Auth not configured"})});function o(e){let{children:t}=e,[r,o]=(0,a.useState)(null),[c,d]=(0,a.useState)(null),[u,h]=(0,a.useState)(!1),g=!!s.N;(0,a.useEffect)(()=>{if(!s.N)return void h(!0);let e=!1;s.N.auth.getSession().then(t=>{var r,n;let{data:a}=t;e||(o(a.session),d(null!=(n=null==(r=a.session)?void 0:r.user)?n:null),h(!0))});let{data:{subscription:t}}=s.N.auth.onAuthStateChange((e,t)=>{var r;o(t),d(null!=(r=null==t?void 0:t.user)?r:null)});return()=>{e=!0,t.unsubscribe()}},[]);let m=(!u||!g)&&!u,p=(0,a.useMemo)(()=>({session:r,user:c,loading:m,ready:u,supabaseAvailable:g,signUp:async(e,t)=>{if(!s.N)return{error:"Auth not configured"};let{error:r}=await s.N.auth.signUp({email:e,password:t});return{error:null==r?void 0:r.message}},signIn:async(e,t)=>{if(!s.N)return{error:"Auth not configured"};let{error:r}=await s.N.auth.signInWithPassword({email:e,password:t});return{error:null==r?void 0:r.message}},signOut:async()=>{if(!s.N)return{error:"Auth not configured"};let{error:e}=await s.N.auth.signOut();return{error:null==e?void 0:e.message}}}),[r,c,m,u,g]);return(0,a.useEffect)(()=>{var e;(0,l.P_)(null!=(e=null==c?void 0:c.id)?e:null),(null==c?void 0:c.id)&&(0,l.n4)(c.id).catch(e=>{console.warn("Failed to hydrate store for user",e)})},[null==c?void 0:c.id]),(0,n.jsx)(i.Provider,{value:p,children:t})}function c(){return(0,a.useContext)(i)}}},e=>{e.O(0,[978,909,970,619,441,255,358],()=>e(e.s=8948)),_N_E=e.O()}]);